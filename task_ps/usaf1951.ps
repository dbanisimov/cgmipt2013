%!PS-Adobe-3.0
%%Pages: 1
%%Creator: Denis Anisimov
%%Title: USAF-1951 Test Chart - CGMIPT2013
%%CreationDate: 11/28/2013
%%DocumentData: Clean7Bit
%%LanguageLevel: 2
%%BoundingBox: 0 0 612 792
%%EndComments

%%BeginProlog
%%EndProlog

%%BeginSetup
%%EndSetup

%%Page: 1 1

%%BeginPageSetup 
/pgsave save def 
%%EndPageSetup

/group-2 [0.078740 0.070150 0.062496 0.055678 0.049603 0.044191] def
/scale-2 1.0 def
/scale-1 0.5 def

/rotation 0 def

/dpi  72 def
/size 0.07 def
/sizep {dpi size mul} def

/Elem {
    newpath
    0 0 moveto 
    sizep 5 mul 0 rlineto
    0 sizep rlineto
    sizep neg 5 mul 0 rlineto
    0 sizep neg rlineto
    closepath
    fill
} def

/ElemGroup {
    3 {
        Elem
        sizep 2 mul 0 exch translate
    } repeat
} def

/Pattern {
    gsave
    gsave
    ElemGroup
    grestore
    sizep 7 mul
    sizep 5 mul translate
    90 neg rotate
    ElemGroup
    grestore
} def

/fontsize 20 def
/Helvetica findfont
fontsize scalefont
setfont

/Group {
% Here should be three parameters of the group
% from step to
{
    /num exch def
    group-2 num 1 sub get 
    /size exch def
    0 sizep 2 mul translate
    Pattern
    gsave
    sizep 3.5 mul fontsize 2 div sub
    -20 exch translate
    0 0 moveto
    rotation 0 ne {
        gsave
        rotation neg rotate
        0 fontsize neg translate
        0 sizep 2 mul translate
        0 0 moveto
        num 1 string cvs show
        grestore
    }{
        num 1 string cvs show
    } ifelse
    grestore
    0 sizep 5 mul translate
} for
} def

% Move somewhere to top center
612 792
exch 2 div % Center of the page
exch translate
% Write title
gsave
/title (USAF-1951 Test Chart) def
/subtitle (Postscript task - CGMIPT2013) def
/author (Author - Denis Anisimov) def
/Helvetica-Bold findfont
30 scalefont
setfont
/Textfromcenter {
    /text exch def
    text stringwidth
    neg exch 
    2 div neg exch
    translate
    0 0 moveto
    text show
    text stringwidth
    exch 2 div exch
    translate
} def
title Textfromcenter
/Helvetica findfont
15 scalefont
setfont
0 -20 translate
subtitle Textfromcenter
0 -20 translate
author Textfromcenter
grestore

% Move to starting point for table
group-2 1 get dpi mul 13 mul neg % Half-width of the table
260 neg % Move from top
translate

/g-2 (-2) def
/g-1 (-1) def

/DrawLayer {
    % Group -2
    scale-2 scale-2 scale
    6 -1 2 Group

    gsave
    sizep 5 mul sizep translate
    0 0 moveto
    g-2 show
    grestore

    % Box
    14 sizep mul 0 translate
    /boxsizep 5 sizep mul def
    newpath
    0 0 moveto
    boxsizep 0 rlineto
    0 boxsizep neg rlineto
    boxsizep neg 0 rlineto
    0 boxsizep rlineto
    closepath
    fill

    boxsizep 0 translate

    % Group -1
    scale-1 scale-1 scale
    /size group-2 0 get def
    14 sizep mul sizep 2 mul translate
    gsave
    sizep 5 mul neg sizep translate
    0 0 moveto
    g-1 show
    grestore

    /rotation 180 def
    rotation rotate
    1 1 6 Group

    0 sizep 14 mul translate

    2 2 scale
    /size group-2 0 get def
    Pattern

    rotation neg rotate
    /rotation 0 def

    gsave
    sizep -1 mul fontsize 2 div add neg
    10 exch translate
    0 0 moveto
    g-2 show
    0 fontsize sizep add neg translate
    0 0 moveto
    (1) show
    grestore
} def

% Draw the first layer
DrawLayer

% Draw the second layer
gsave
/DrawNextLayer {
    -12.5 sizep mul 4 sizep mul translate
    0.25 0.25 scale
    DrawLayer
} def

/g-2 (0) def
/g-1 (1) def
DrawNextLayer

% Draw the next layer
gsave
/g-2 (2) def
/g-1 (3) def
DrawNextLayer

grestore
grestore

0 sizep 5 mul neg translate
sizep 12 mul neg 0 translate

/usaf (USAF-1951) def
usaf stringwidth
pop 2 div neg 
fontsize neg
translate
0 0 moveto
usaf show

pgsave restore showpage

%%PageTrailer
%%Trailer

%%EOF
